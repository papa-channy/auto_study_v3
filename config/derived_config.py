import json
import random
from pathlib import Path

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ“ ê¸°ë³¸ ê²½ë¡œ ì„¤ì •
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
CONFIG_DIR = Path(__file__).parent
SETTING_PATH = CONFIG_DIR / "setting_config.json"

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ“¥ ì„¤ì • íŒŒì¼ ë¡œë“œ
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
with open(SETTING_PATH, encoding="utf-8") as f:
    config = json.load(f)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ“Š ì„¤ì • í•­ëª© ì¶”ì¶œ
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
study_matrix = config["study_matrix&difficulty"]  # ë„êµ¬ë³„ ë‚œì´ë„
call_count = config["count"]                      # ë„êµ¬ë³„ í˜¸ì¶œ íšŸìˆ˜
example_count = config.get("example_count", 2)    # ì˜ˆì‹œ ê°œìˆ˜ (ê¸°ë³¸ê°’ 2)
all_datasets = config["DATASET"]                  # ì „ì²´ ë°ì´í„°ì…‹ ëª©ë¡

# ğŸ”¢ ëœë¤ìœ¼ë¡œ ì„ íƒí•  dataset ìˆ˜ (ê¸°ë³¸ê°’: 3ê°œ)
random_dataset_count = config.get("random_dataset_count", 3)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ§  ë„êµ¬ë³„ ë¬¸ì œ ìˆ˜ ê³„ì‚°
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
tool_summary = {}

for tool, difficulties in study_matrix.items():
    difficulty_count = len(difficulties)
    total_questions = difficulty_count * call_count
    batch_size = call_count  # í˜¸ì¶œ íšŸìˆ˜ = í•œ ë²ˆì— ìƒì„±í•  ë¬¸ì œ ìˆ˜ ê¸°ì¤€ (ìˆ˜ì • ê°€ëŠ¥)

    tool_summary[tool] = {
        "difficulties": difficulties,
        "total_questions": total_questions,
        "batch_size": batch_size,
        "calls": call_count
    }

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ§¾ ìµœì¢… êµ¬ì„± ê°ì²´
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
DERIVED_CONFIG = {
    "tool_summary": tool_summary,
    "total_questions": sum(t["total_questions"] for t in tool_summary.values()),
    "example_count_per_prompt": example_count,
    "random_dataset_count": random_dataset_count,
    "random_datasets": random.sample(all_datasets, min(random_dataset_count, len(all_datasets)))
}
